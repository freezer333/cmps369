<!doctype html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Scott Frees</title>

<style type='text/css'>
  *{margin:0;padding:0;}
  body {
    font:13.34px helvetica,arial,freesans,clean,sans-serif;
    color:black;
    line-height:1.4em;
    background-color: #F8F8F8;
    padding: 0.7em;
  }
  p {
    margin:1em 0;
    line-height:1.5em;
  }
  table {
    font-size:inherit;
    font:100%;
    margin-top:1em;
    margin-bottom:1em;
  }
  table th{border-bottom:1px solid #bbb;padding:.2em 1em;}
  table td{border-bottom:1px solid #ddd;padding:.2em 1em;}
  input[type=text],input[type=password],input[type=image],textarea{font:99% helvetica,arial,freesans,sans-serif;}
  select,option{padding:0 .25em;}
  optgroup{margin-top:.5em;}
  pre,code{font:12px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
  pre {
    margin:1em 0;
    font-size:12px;
    background-color:#eee;
    border:1px solid #ddd;
    padding:5px;
    line-height:1.5em;
    color:#444;
    overflow:auto;
    -webkit-box-shadow:rgba(0,0,0,0.07) 0 1px 2px inset;
    -webkit-border-radius:3px;
    -moz-border-radius:3px;border-radius:3px;
  }
  pre code {
    padding:0;
    font-size:12px;
    background-color:#eee;
    border:none;
  }
  code {
    font-size:12px;
    background-color:#f8f8ff;
    color:#444;
    padding:0 .2em;
    border:1px solid #dedede;
  }
  img{border:0;max-width:100%;}
  abbr{border-bottom:none;}
  a{color:#4183c4;text-decoration:none;}
  a:hover{text-decoration:underline;}
  a code,a:link code,a:visited code{color:#4183c4;}
  h2,h3{margin:1em 0;}
  h1,h2,h3,h4,h5,h6{border:0;}
  h1{font-size:170%;border-top:4px solid #aaa;padding-top:.5em;margin-top:1.5em;}
  h1:first-child{margin-top:0;padding-top:.25em;border-top:none;}
  h2{font-size:150%;margin-top:1.5em;border-top:4px solid #e0e0e0;padding-top:.5em;}
  h3{margin-top:1em;}
  hr{border:1px solid #ddd;}
  ul{margin:1em 0 1em 2em;}
  ol{margin:1em 0 1em 2em;}
  ul li,ol li{margin-top:.5em;margin-bottom:.5em;}
  ul ul,ul ol,ol ol,ol ul{margin-top:0;margin-bottom:0;}
  blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555;}
  dt{font-weight:bold;margin-left:1em;}
  dd{margin-left:2em;margin-bottom:1em;}
  sup {
      font-size: 0.83em;
      vertical-align: super;
      line-height: 0;
  }
  * {
    -webkit-print-color-adjust: exact;
  }

  .highlight {
    background-color:#f1c40f;
    padding-bottom:1em;
    padding-right:1em;
    padding-left:1em;
    font-weight:bold;
  }
  @media screen and (min-width: 914px) {
      body {
          width: 854px;
          margin:0 auto;
      }
  }
  @media print {
    table, pre {
      page-break-inside: avoid;
    }
    pre {
      word-wrap: break-word;
    }
    .print-page {page-break-after: always;}
    body {
      background-color: white
    }
  }


</style>

</head>
<p><a href="https://travis-ci.org/superjoe30/node-multiparty"><img src="https://travis-ci.org/superjoe30/node-multiparty.png?branch=master" alt="Build Status"></a></p>
<h1 id="multiparty">multiparty</h1>
<p>Parse http requests with content-type <code>multipart/form-data</code>, also known as file uploads.</p>
<p>See also <a href="https://github.com/mscdex/busboy">busboy</a> - a<br><a href="https://github.com/mscdex/dicer/wiki/Benchmarks">faster</a> alternative<br>which may be worth looking into.</p>
<h3 id="why-the-fork-">Why the fork?</h3>
<ul>
<li>This module uses the Node.js v0.10 streams properly, <em>even in Node.js v0.8</em></li>
<li>It will not create a temp file for you unless you want it to.</li>
<li>Counts bytes and does math to help you figure out the <code>Content-Length</code> of<br>each part.</li>
<li>You can easily stream uploads to s3 with<br><a href="https://github.com/LearnBoost/knox">knox</a>, for <a href="examples/s3.js">example</a>.</li>
<li>Less bugs. This code is simpler, has all deprecated functionality removed,<br>has cleaner tests, and does not try to do anything beyond multipart stream<br>parsing.</li>
</ul>
<h2 id="installation">Installation</h2>
<pre><code>npm install multiparty
</code></pre><h2 id="usage">Usage</h2>
<ul>
<li>See <a href="examples">examples</a>.</li>
</ul>
<p>Parse an incoming <code>multipart/form-data</code> request.</p>
<pre><code class="lang-js">var multiparty = require(&#39;multiparty&#39;)
  , http = require(&#39;http&#39;)
  , util = require(&#39;util&#39;)

http.createServer(function(req, res) {
  if (req.url === &#39;/upload&#39; &amp;&amp; req.method === &#39;POST&#39;) {
    // parse a file upload
    var form = new multiparty.Form();

    form.parse(req, function(err, fields, files) {
      res.writeHead(200, {&#39;content-type&#39;: &#39;text/plain&#39;});
      res.write(&#39;received upload:\n\n&#39;);
      res.end(util.inspect({fields: fields, files: files}));
    });

    return;
  }

  // show a file upload form
  res.writeHead(200, {&#39;content-type&#39;: &#39;text/html&#39;});
  res.end(
    &#39;&lt;form action=&quot;/upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;&#39;+
    &#39;&lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;&lt;br&gt;&#39;+
    &#39;&lt;input type=&quot;file&quot; name=&quot;upload&quot; multiple=&quot;multiple&quot;&gt;&lt;br&gt;&#39;+
    &#39;&lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;&#39;+
    &#39;&lt;/form&gt;&#39;
  );
}).listen(8080);
</code></pre>
<h2 id="api">API</h2>
<h3 id="multiparty-form">multiparty.Form</h3>
<pre><code class="lang-js">var form = new multiparty.Form(options)
</code></pre>
<p>Creates a new form. Options:</p>
<ul>
<li><code>encoding</code> - sets encoding for the incoming form fields. Defaults to <code>utf8</code>.</li>
<li><code>maxFieldSize</code> - Limits the amount of memory a field (not a file) can<br>allocate in bytes. If this value is exceeded, an <code>error</code> event is emitted.<br>The default size is 2MB.</li>
<li><code>maxFields</code> - Limits the number of fields that will be parsed before<br>emitting an <code>error</code> event. A file counts as a field in this case.<br>Defaults to 1000.</li>
<li><code>autoFields</code> - Enables <code>field</code> events. This is automatically set to <code>true</code><br>if you add a <code>field</code> listener.</li>
<li><code>autoFiles</code> - Enables <code>file</code> events. This is automatically set to <code>true</code><br>if you add a <code>file</code> listener.</li>
<li><code>uploadDir</code> - Only relevant when <code>autoFiles</code> is <code>true</code>. The directory for<br>placing file uploads in. You can move them later using <code>fs.rename()</code>.<br>Defaults to <code>os.tmpDir()</code>.</li>
<li><code>hash</code> - Only relevant when <code>autoFiles</code> is <code>true</code>. If you want checksums<br>calculated for incoming files, set this to either <code>sha1</code> or <code>md5</code>.<br>Defaults to off.</li>
</ul>
<h4 id="form-parse-request-cb-">form.parse(request, [cb])</h4>
<p>Parses an incoming node.js <code>request</code> containing form data. If <code>cb</code> is<br>provided, <code>autoFields</code> and <code>autoFiles</code> are set to <code>true</code> and all fields and<br>files are collected and passed to the callback:</p>
<pre><code class="lang-js">form.parse(req, function(err, fieldsObject, filesObject, fieldsList, filesList) {
  // ...
});
</code></pre>
<p>It is often convenient to access a field or file by name. In this situation,<br>use <code>fieldsObject</code> or <code>filesObject</code>. However sometimes, as in the case of a<br><code>&lt;input type=&quot;file&quot; multiple=&quot;multiple&quot;&gt;</code> the multipart stream will contain<br>multiple files of the same input name, and you are interested in all of them.<br>In this case, use <code>filesList</code>.</p>
<p>Another example is when you do not care what the field name of a file is; you<br>are merely interested in a single upload. In this case, set <code>maxFields</code> to 1<br>(assuming no other fields expected besides the file) and use <code>filesList[0]</code>.</p>
<h4 id="form-bytesreceived">form.bytesReceived</h4>
<p>The amount of bytes received for this form so far.</p>
<h4 id="form-bytesexpected">form.bytesExpected</h4>
<p>The expected number of bytes in this form.</p>
<h3 id="events">Events</h3>
<h4 id="-error-err-">&#39;error&#39; (err)</h4>
<p>You definitely want to handle this event. If not your server <em>will</em> crash when<br>users submit bogus multipart requests!</p>
<h4 id="-part-part-">&#39;part&#39; (part)</h4>
<p>Emitted when a part is encountered in the request. <code>part</code> is a<br><code>ReadableStream</code>. It also has the following properties:</p>
<ul>
<li><code>headers</code> - the headers for this part. For example, you may be interested<br>in <code>content-type</code>.</li>
<li><code>name</code> - the field name for this part</li>
<li><code>filename</code> - only if the part is an incoming file</li>
<li><code>byteOffset</code> - the byte offset of this part in the request body</li>
<li><code>byteCount</code> - assuming that this is the last part in the request,<br>this is the size of this part in bytes. You could use this, for<br>example, to set the <code>Content-Length</code> header if uploading to S3.<br>If the part had a <code>Content-Length</code> header then that value is used<br>here instead.</li>
</ul>
<h4 id="-aborted-">&#39;aborted&#39;</h4>
<p>Emitted when the request is aborted. This event will be followed shortly<br>by an <code>error</code> event. In practice you do not need to handle this event.</p>
<h4 id="-progress-bytesreceived-bytesexpected-">&#39;progress&#39; (bytesReceived, bytesExpected)</h4>
<h4 id="-close-">&#39;close&#39;</h4>
<p>Emitted after all parts have been parsed and emitted. Not emitted if an <code>error</code><br>event is emitted. This is typically when you would send your response.</p>
<h4 id="-file-name-file-">&#39;file&#39; (name, file)</h4>
<p><strong>By default multiparty will not touch your hard drive.</strong> But if you add this<br>listener, multiparty automatically sets <code>form.autoFiles</code> to <code>true</code> and will<br>stream uploads to disk for you. </p>
<ul>
<li><code>name</code> - the field name for this file</li>
<li><code>file</code> - an object with these properties:<ul>
<li><code>fieldName</code> - same as <code>name</code> - the field name for this file</li>
<li><code>originalFilename</code> - the filename that the user reports for the file</li>
<li><code>path</code> - the absolute path of the uploaded file on disk</li>
<li><code>headers</code> - the HTTP headers that were sent along with this file</li>
<li><code>size</code> - size of the file in bytes</li>
</ul>
</li>
</ul>
<p>If you set the <code>form.hash</code> option, then <code>file</code> will also contain a <code>hash</code><br>property which is the checksum of the file.</p>
<h4 id="-field-name-value-">&#39;field&#39; (name, value)</h4>
<ul>
<li><code>name</code> - field name</li>
<li><code>value</code> - string field value</li>
</ul>
</html>